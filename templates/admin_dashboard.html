<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='maintenance_ticket.png') }}">
</head>
<body>
    <h1>Admin Dashboard</h1>
    <div class="container mt-4 mb-5">

   <!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='maintenance_ticket.png') }}">
</head>
<body>
<header style="background-color:#f28b82; color: white; padding: 20px;">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="fw-bold mb-0">ADMIN DASHBOARD</h1>
            <p class="mb-0">Maintenance Ticket Management</p>
        </div>
        <a href="{{ url_for('logout') }}"
           class="btn btn-light text-danger fw-semibold"
           style="border-radius: 6px;">LOG OUT</a>
    </div>
</header>

<div class="container mt-4 mb-5">

<!-- SEARCH BAR -->
<form method="GET" action="{{ url_for('search_users') }}" class="d-flex mb-4" role="search">
    <input class="form-control me-2" type="search" name="q" placeholder="Search users..." aria-label="Search" required>
    <button class="btn btn-outline-primary" type="submit">Search</button>
</form>

<!-- ADMIN INFO -->
<div class="user-info mb-4">
    <h3>Welcome, {{ user.first_name }} {{ user.last_name }}!</h3>
    <p>Your role: <strong>{{ user.role|upper }}</strong></p>
</div>

<!-- USERS TABLE -->
<div class="card shadow-sm mb-5">
    <div class="card-header bg-danger text-white fw-semibold">
        All Users
    </div>
    <div class="card-body p-0">
        <table class="table table-striped mb-0">
            <thead class="table-light">
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Role</th>
                    <th>Username</th>
                    <th>Email</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.first_name }}</td>
                    <td>{{ user.last_name }}</td>
                    <td>{{ user.role }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- FILTERS -->
<div class="d-flex gap-2 align-items-center mb-3">
    <select id="deptFilter" class="form-select" style="width: 200px;">
        <option value="All">All Departments</option>
        <option value="Electrical">Electrical</option>
        <option value="Plumbing">Plumbing</option>
        <option value="Carpentry">Carpentry</option>
    </select>

    <select id="statusFilter" class="form-select" style="width: 200px;">
        <option value="All">All Status</option>
        <option value="Pending">Pending</option>
        <option value="Approved">Approved</option>
        <option value="Done">Done</option>
    </select>
</div>

<!-- TICKETS TABLE -->
<div class="card shadow-sm">
    <div class="card-header bg-danger text-white fw-semibold">
        All Tickets
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0" id="ticketTable">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Employee</th>
                    <th>Department</th>
                    <th>Description</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="ticketBody">
                {% for ticket in tickets %}
                <tr>
                    <td>{{ ticket.id }}</td>
                    <td>{{ ticket.submitted_name }}</td>
                    <td>{{ ticket.category }}</td>
                    <td>{{ ticket.description }}</td>
                    <td>{{ ticket.status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

</div>

<footer>
    <p class="mb-0 text-center">&copy; 2025 | Designed by Poging Noy TEOPE</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // FILTER LOGIC (AJAX)
    document.addEventListener("DOMContentLoaded", () => {
        const deptFilter = document.getElementById("deptFilter");
        const statusFilter = document.getElementById("statusFilter");
        const ticketBody = document.getElementById("ticketBody");

        function fetchFilteredTickets() {
            const dept = deptFilter.value;
            const status = statusFilter.value;

            fetch(`/filter_tickets?department=${dept}&status=${status}`)
                .then(res => res.json())
                .then(data => {
                    ticketBody.innerHTML = "";

                    if (data.length === 0) {
                        ticketBody.innerHTML = `<tr><td colspan="5" class="text-center text-muted py-3">No tickets found.</td></tr>`;
                        return;
                    }

                    data.forEach(t => {
                        const row = `
                            <tr>
                                <td>${t.id}</td>
                                <td>${t.submitted_name}</td>
                                <td>${t.category}</td>
                                <td>${t.description}</td>
                                <td>${t.status}</td>
                            </tr>
                        `;
                        ticketBody.innerHTML += row;
                    });
                });
        }

        deptFilter.addEventListener("change", fetchFilteredTickets);
        statusFilter.addEventListener("change", fetchFilteredTickets);
    });
</script>

<footer>
    <p class="mb-0">&copy; 2025 | Designed by Poging Noy TEOPE</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
</body>
</html>
